<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Job Applications</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .admin-header {
            background: #2c5aa0;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .admin-header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .stats-bar {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #2c5aa0;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }

        .applications-list {
            padding: 20px;
        }

        .application-card {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .application-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .application-header:hover {
            background: #e9ecef;
        }

        .applicant-info h3 {
            margin: 0;
            color: #333;
            font-size: 18px;
        }

        .applicant-info p {
            margin: 5px 0 0 0;
            color: #666;
            font-size: 14px;
        }

        .application-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-submitted {
            background: #d4edda;
            color: #155724;
        }

        .application-details {
            display: none;
            padding: 20px;
            background: white;
        }

        .application-details.expanded {
            display: block;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section h4 {
            color: #2c5aa0;
            margin-bottom: 10px;
            font-size: 16px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 5px;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .detail-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
        }

        .detail-label {
            font-weight: bold;
            color: #333;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .detail-value {
            color: #666;
            font-size: 14px;
            word-break: break-word;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 40px;
            color: #d73502;
        }

        .refresh-btn {
            background: #2c5aa0;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .refresh-btn:hover {
            background: #1e3d6f;
        }

        .expand-arrow {
            transition: transform 0.3s ease;
        }

        .expand-arrow.rotated {
            transform: rotate(180deg);
        }

        .full-width {
            grid-column: 1 / -1;
        }

        .behavioral-answer {
            max-height: 100px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.4;
        }

        .resume-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .download-btn {
            display: inline-block;
            background: #2c5aa0;
            color: white;
            padding: 6px 12px;
            text-decoration: none;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 8px;
            margin-top: 4px;
            transition: background 0.3s ease;
        }

        .download-btn:hover {
            background: #1e3d6f;
            color: white;
        }

        .detail-value a {
            color: #2c5aa0;
            text-decoration: none;
        }

        .detail-value a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .stats-bar {
                flex-direction: column;
                gap: 10px;
            }

            .detail-grid {
                grid-template-columns: 1fr;
            }

            .download-btn {
                margin-bottom: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>Job Applications Dashboard</h1>
            <p>Software & Automation Developer Position</p>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-number" id="totalApplications">0</div>
                <div class="stat-label">Total Applications</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="todayApplications">0</div>
                <div class="stat-label">Today</div>
            </div>
            <div class="stat-item">
                <button class="refresh-btn" onclick="loadApplications()">Refresh Data</button>
                <button class="refresh-btn" onclick="downloadAllData()" style="margin-left: 10px;">Download All Data (JSON)</button>
                <a href="/api/download-applications" class="refresh-btn" style="margin-left: 10px; text-decoration: none; display: inline-block;">üì• Server Download</a>
            </div>
        </div>

        <div class="applications-list" id="applicationsList">
            <div class="loading">Loading applications...</div>
        </div>
    </div>

    <script>
        let applications = [];

        async function loadApplications() {
            try {
                const response = await fetch('/api/applications');
                applications = await response.json();
                
                updateStats();
                renderApplications();
            } catch (error) {
                document.getElementById('applicationsList').innerHTML = 
                    '<div class="error">Error loading applications. Please try again.</div>';
            }
        }

        function updateStats() {
            const total = applications.length;
            const today = applications.filter(app => {
                const appDate = new Date(app.submissionTime).toDateString();
                const todayDate = new Date().toDateString();
                return appDate === todayDate;
            }).length;

            document.getElementById('totalApplications').textContent = total;
            document.getElementById('todayApplications').textContent = today;
        }

        function renderApplications() {
            const container = document.getElementById('applicationsList');
            
            if (applications.length === 0) {
                container.innerHTML = '<div class="loading">No applications submitted yet.</div>';
                return;
            }

            const html = applications.map((app, index) => `
                <div class="application-card">
                    <div class="application-header" onclick="toggleApplication(${index})">
                        <div class="applicant-info">
                            <h3>${app.formData?.firstName || 'N/A'} ${app.formData?.lastName || 'N/A'}</h3>
                            <p>${app.formData?.phone || 'N/A'} ‚Ä¢ ${new Date(app.submissionTime).toLocaleDateString()}</p>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button class="download-btn" onclick="downloadSingleApplication(${index}); event.stopPropagation();" title="Download this application data">üì• JSON</button>
                            <span class="application-status status-${app.status}">${app.status}</span>
                            <span class="expand-arrow" id="arrow-${index}">‚ñº</span>
                        </div>
                    </div>
                    <div class="application-details" id="details-${index}">
                        ${renderApplicationDetails(app)}
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function renderApplicationDetails(app) {
            const data = app.formData || {};
            const user = app.user || {};
            
            return `
                <div class="detail-section">
                    <h4>Account Information</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Email</div>
                            <div class="detail-value">${user.email || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Password</div>
                            <div class="detail-value">${user.password || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Account Created</div>
                            <div class="detail-value">${user.signupTime ? new Date(user.signupTime).toLocaleString() : (user.createdAt ? new Date(user.createdAt).toLocaleString() : 'N/A')}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h4>Personal Information</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">First Name</div>
                            <div class="detail-value">${data.firstName || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Last Name</div>
                            <div class="detail-value">${data.lastName || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Phone Number</div>
                            <div class="detail-value">${data.phone || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">LinkedIn Profile</div>
                            <div class="detail-value">${data.linkedin ? `<a href="${data.linkedin}" target="_blank">${data.linkedin}</a>` : 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">GitHub Profile</div>
                            <div class="detail-value">${data.github ? `<a href="${data.github}" target="_blank">${data.github}</a>` : 'N/A'}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h4>Complete Address</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Unit Number</div>
                            <div class="detail-value">${data.unitNumber || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Street Address</div>
                            <div class="detail-value">${data.streetAddress || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">City</div>
                            <div class="detail-value">${data.city || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Country</div>
                            <div class="detail-value">${data.country || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Pin Code</div>
                            <div class="detail-value">${data.pinCode || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Full Address</div>
                            <div class="detail-value">${[data.unitNumber, data.streetAddress, data.city, data.country, data.pinCode].filter(Boolean).join(', ')}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h4>Work Experience & Resume</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Job Title</div>
                            <div class="detail-value">${data.jobTitle1 || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Company</div>
                            <div class="detail-value">${data.company1 || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Work Location</div>
                            <div class="detail-value">${data.location1 || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Currently Working</div>
                            <div class="detail-value">${data.currentWork1 ? 'Yes' : 'No'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Start Date</div>
                            <div class="detail-value">${data.fromDate1 || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">End Date</div>
                            <div class="detail-value">${data.toDate1 || (data.currentWork1 ? 'Present' : 'N/A')}</div>
                        </div>
                        <div class="detail-item full-width">
                            <div class="detail-label">Role Description</div>
                            <div class="detail-value">${data.roleDescription1 || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Resume File</div>
                            <div class="detail-value">
                                ${app.resume ? `
                                    <div class="resume-info">
                                        <strong>${app.resume.originalName}</strong><br>
                                        <small>Size: ${(app.resume.size / 1024).toFixed(1)} KB</small><br>
                                        <a href="/uploads/${app.resume.filename}" target="_blank" class="download-btn">üìÑ View Resume</a>
                                        <a href="/uploads/${app.resume.filename}" download="${app.resume.originalName}" class="download-btn">‚¨áÔ∏è Download</a>
                                    </div>
                                ` : 'No resume uploaded'}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h4>Application Questions</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Meets Basic Requirements</div>
                            <div class="detail-value">${data.basicRequirements || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Work Authorization</div>
                            <div class="detail-value">${data.workAuthorized || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Sponsorship Required</div>
                            <div class="detail-value">${data.sponsorshipRequired || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">OPT Training</div>
                            <div class="detail-value">${data.optTraining || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Years of Experience</div>
                            <div class="detail-value">${data.yearsExperience || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Previous DIce Employee</div>
                            <div class="detail-value">${data.previousKLA || 'N/A'}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h4>Behavioral Assessment Questions</h4>
                    <div class="detail-grid">
                        <div class="detail-item full-width">
                            <div class="detail-label">What are you passionate about outside of technology?</div>
                            <div class="detail-value behavioral-answer">${data.passion || 'N/A'}</div>
                        </div>
                        <div class="detail-item full-width">
                            <div class="detail-label">Describe working with challenging people</div>
                            <div class="detail-value behavioral-answer">${data.difficultPeople || 'N/A'}</div>
                        </div>
                        <div class="detail-item full-width">
                            <div class="detail-label">Time management and work-life balance</div>
                            <div class="detail-value behavioral-answer">${data.timeManagement || 'N/A'}</div>
                        </div>
                        <div class="detail-item full-width">
                            <div class="detail-label">Handling difficult situations</div>
                            <div class="detail-value behavioral-answer">${data.resilienceType || 'N/A'}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h4>Voluntary Disclosures</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Veteran Status</div>
                            <div class="detail-value">${data.veteranStatus || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Race/Ethnicity</div>
                            <div class="detail-value">${data.race || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Consent to Terms</div>
                            <div class="detail-value">${data.consentTerms ? 'Yes' : 'No'}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h4>Self-Identification (Disability)</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Language</div>
                            <div class="detail-value">${data.language || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Disability Name</div>
                            <div class="detail-value">${data.disabilityName || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Disability Date</div>
                            <div class="detail-value">${data.disabilityDate || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Disability Status</div>
                            <div class="detail-value">${data.disabilityStatus || 'N/A'}</div>
                        </div>
                    </div>
                </div>

                <div class="detail-section">
                    <h4>Application Metadata</h4>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">Application ID</div>
                            <div class="detail-value">${app.id || 'N/A'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Submission Time</div>
                            <div class="detail-value">${new Date(app.submissionTime).toLocaleString()}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Application Status</div>
                            <div class="detail-value">${app.status || 'N/A'}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function toggleApplication(index) {
            const details = document.getElementById(`details-${index}`);
            const arrow = document.getElementById(`arrow-${index}`);
            
            if (details.classList.contains('expanded')) {
                details.classList.remove('expanded');
                arrow.classList.remove('rotated');
            } else {
                details.classList.add('expanded');
                arrow.classList.add('rotated');
            }
        }

        function downloadSingleApplication(index) {
            const app = applications[index];
            if (!app) {
                alert('Application not found.');
                return;
            }

            // Create comprehensive single application export
            const exportData = {
                exportInfo: {
                    exportDate: new Date().toISOString(),
                    exportType: 'Single Application',
                    applicationId: app.id,
                    exportedBy: 'Admin Dashboard'
                },
                application: {
                    applicationId: app.id,
                    submissionTime: app.submissionTime,
                    status: app.status,
                    
                    // Account Information (including password)
                    accountInfo: {
                        email: app.user?.email || 'N/A',
                        password: app.user?.password || 'N/A',
                        accountCreated: app.user?.signupTime || app.user?.createdAt || 'N/A'
                    },
                    
                    // Personal Information
                    personalInfo: {
                        firstName: app.formData?.firstName || 'N/A',
                        lastName: app.formData?.lastName || 'N/A',
                        phone: app.formData?.phone || 'N/A',
                        linkedin: app.formData?.linkedin || 'N/A',
                        github: app.formData?.github || 'N/A'
                    },
                    
                    // Complete Address
                    address: {
                        unitNumber: app.formData?.unitNumber || 'N/A',
                        streetAddress: app.formData?.streetAddress || 'N/A',
                        city: app.formData?.city || 'N/A',
                        country: app.formData?.country || 'N/A',
                        pinCode: app.formData?.pinCode || 'N/A',
                        fullAddress: [
                            app.formData?.unitNumber,
                            app.formData?.streetAddress,
                            app.formData?.city,
                            app.formData?.country,
                            app.formData?.pinCode
                        ].filter(Boolean).join(', ')
                    },
                    
                    // Work Experience
                    workExperience: {
                        jobTitle: app.formData?.jobTitle1 || 'N/A',
                        company: app.formData?.company1 || 'N/A',
                        location: app.formData?.location1 || 'N/A',
                        currentlyWorking: app.formData?.currentWork1 ? 'Yes' : 'No',
                        startDate: app.formData?.fromDate1 || 'N/A',
                        endDate: app.formData?.toDate1 || (app.formData?.currentWork1 ? 'Present' : 'N/A'),
                        roleDescription: app.formData?.roleDescription1 || 'N/A'
                    },
                    
                    // Resume Information
                    resume: {
                        uploaded: app.resume ? 'Yes' : 'No',
                        fileName: app.resume?.originalName || 'N/A',
                        fileSize: app.resume?.size ? `${(app.resume.size / 1024).toFixed(1)} KB` : 'N/A',
                        serverFileName: app.resume?.filename || 'N/A',
                        downloadUrl: app.resume ? `/uploads/${app.resume.filename}` : 'N/A'
                    },
                    
                    // Application Questions
                    applicationQuestions: {
                        meetsBasicRequirements: app.formData?.basicRequirements || 'N/A',
                        workAuthorization: app.formData?.workAuthorized || 'N/A',
                        sponsorshipRequired: app.formData?.sponsorshipRequired || 'N/A',
                        optTraining: app.formData?.optTraining || 'N/A',
                        yearsOfExperience: app.formData?.yearsExperience || 'N/A',
                        previousDIceEmployee: app.formData?.previousKLA || 'N/A'
                    },
                    
                    // Behavioral Assessment
                    behavioralAssessment: {
                        passion: app.formData?.passion || 'N/A',
                        workingWithDifficultPeople: app.formData?.difficultPeople || 'N/A',
                        timeManagement: app.formData?.timeManagement || 'N/A',
                        handlingDifficultSituations: app.formData?.resilienceType || 'N/A'
                    },
                    
                    // Voluntary Disclosures
                    voluntaryDisclosures: {
                        veteranStatus: app.formData?.veteranStatus || 'N/A',
                        gender: app.formData?.gender || 'N/A',
                        hispanic: app.formData?.hispanic || 'N/A',
                        race: app.formData?.race || 'N/A',
                        consentToTerms: app.formData?.consentTerms ? 'Yes' : 'No'
                    },
                    
                    // Self-Identification (Disability)
                    disabilityInfo: {
                        language: app.formData?.language || 'N/A',
                        disabilityName: app.formData?.disabilityName || 'N/A',
                        disabilityDate: app.formData?.disabilityDate || 'N/A',
                        disabilityStatus: app.formData?.disabilityStatus || 'N/A',
                        employeeId: app.formData?.employeeId || 'N/A'
                    },
                    
                    // Raw form data (complete backup)
                    rawFormData: app.formData || {},
                    rawUserData: app.user || {}
                }
            };

            // Create and download the JSON file
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const applicantName = `${app.formData?.firstName || 'Unknown'}-${app.formData?.lastName || 'Applicant'}`.replace(/\s+/g, '-');
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `application-${applicantName}-${app.id}-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function downloadAllData() {
            if (applications.length === 0) {
                alert('No applications to download. Please refresh data first.');
                return;
            }

            // Create comprehensive data export including all user information
            const exportData = {
                exportInfo: {
                    exportDate: new Date().toISOString(),
                    totalApplications: applications.length,
                    exportedBy: 'Admin Dashboard',
                    version: '1.0'
                },
                applications: applications.map(app => ({
                    applicationId: app.id,
                    submissionTime: app.submissionTime,
                    status: app.status,
                    
                    // Account Information (including password)
                    accountInfo: {
                        email: app.user?.email || 'N/A',
                        password: app.user?.password || 'N/A',
                        accountCreated: app.user?.signupTime || app.user?.createdAt || 'N/A'
                    },
                    
                    // Personal Information
                    personalInfo: {
                        firstName: app.formData?.firstName || 'N/A',
                        lastName: app.formData?.lastName || 'N/A',
                        phone: app.formData?.phone || 'N/A',
                        linkedin: app.formData?.linkedin || 'N/A',
                        github: app.formData?.github || 'N/A'
                    },
                    
                    // Complete Address
                    address: {
                        unitNumber: app.formData?.unitNumber || 'N/A',
                        streetAddress: app.formData?.streetAddress || 'N/A',
                        city: app.formData?.city || 'N/A',
                        country: app.formData?.country || 'N/A',
                        pinCode: app.formData?.pinCode || 'N/A',
                        fullAddress: [
                            app.formData?.unitNumber,
                            app.formData?.streetAddress,
                            app.formData?.city,
                            app.formData?.country,
                            app.formData?.pinCode
                        ].filter(Boolean).join(', ')
                    },
                    
                    // Work Experience
                    workExperience: {
                        jobTitle: app.formData?.jobTitle1 || 'N/A',
                        company: app.formData?.company1 || 'N/A',
                        location: app.formData?.location1 || 'N/A',
                        currentlyWorking: app.formData?.currentWork1 ? 'Yes' : 'No',
                        startDate: app.formData?.fromDate1 || 'N/A',
                        endDate: app.formData?.toDate1 || (app.formData?.currentWork1 ? 'Present' : 'N/A'),
                        roleDescription: app.formData?.roleDescription1 || 'N/A'
                    },
                    
                    // Resume Information
                    resume: {
                        uploaded: app.resume ? 'Yes' : 'No',
                        fileName: app.resume?.originalName || 'N/A',
                        fileSize: app.resume?.size ? `${(app.resume.size / 1024).toFixed(1)} KB` : 'N/A',
                        serverFileName: app.resume?.filename || 'N/A',
                        downloadUrl: app.resume ? `/uploads/${app.resume.filename}` : 'N/A'
                    },
                    
                    // Application Questions
                    applicationQuestions: {
                        meetsBasicRequirements: app.formData?.basicRequirements || 'N/A',
                        workAuthorization: app.formData?.workAuthorized || 'N/A',
                        sponsorshipRequired: app.formData?.sponsorshipRequired || 'N/A',
                        optTraining: app.formData?.optTraining || 'N/A',
                        yearsOfExperience: app.formData?.yearsExperience || 'N/A',
                        previousDIceEmployee: app.formData?.previousKLA || 'N/A'
                    },
                    
                    // Behavioral Assessment
                    behavioralAssessment: {
                        passion: app.formData?.passion || 'N/A',
                        workingWithDifficultPeople: app.formData?.difficultPeople || 'N/A',
                        timeManagement: app.formData?.timeManagement || 'N/A',
                        handlingDifficultSituations: app.formData?.resilienceType || 'N/A'
                    },
                    
                    // Voluntary Disclosures
                    voluntaryDisclosures: {
                        veteranStatus: app.formData?.veteranStatus || 'N/A',
                        gender: app.formData?.gender || 'N/A',
                        hispanic: app.formData?.hispanic || 'N/A',
                        race: app.formData?.race || 'N/A',
                        consentToTerms: app.formData?.consentTerms ? 'Yes' : 'No'
                    },
                    
                    // Self-Identification (Disability)
                    disabilityInfo: {
                        language: app.formData?.language || 'N/A',
                        disabilityName: app.formData?.disabilityName || 'N/A',
                        disabilityDate: app.formData?.disabilityDate || 'N/A',
                        disabilityStatus: app.formData?.disabilityStatus || 'N/A',
                        employeeId: app.formData?.employeeId || 'N/A'
                    },
                    
                    // Raw form data (complete backup)
                    rawFormData: app.formData || {}
                }))
            };

            // Create and download the JSON file
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `job-applications-export-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Show success message
            alert(`Successfully downloaded ${applications.length} applications with complete data including passwords and resume information.`);
        }

        // Load applications when page loads
        document.addEventListener('DOMContentLoaded', loadApplications);
    </script>
</body>
</html>
